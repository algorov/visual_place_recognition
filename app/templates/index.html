<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ</title>
  <link rel="stylesheet" href="./static/styles.css" />
</head>
<body>
  <div class="container">
    <h1>üé• –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞</h1>

    <input type="file" id="fileInput" accept="video/*" />
    <div class="video-wrapper hidden" id="videoWrapper">
      <video id="videoPreview" controls></video>
    </div>
    <button id="uploadBtn" disabled>üöÄ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>

    <div id="message"></div>
    <div id="results"></div>
  </div>

  <script>
    const fileInput = document.getElementById("fileInput");
    const videoPreview = document.getElementById("videoPreview");
    const videoWrapper = document.getElementById("videoWrapper");
    const uploadBtn = document.getElementById("uploadBtn");
    const message = document.getElementById("message");
    const results = document.getElementById("results");

    let selectedFile = null;

    fileInput.addEventListener("change", () => {
      const file = fileInput.files[0];
      if (file && file.type.startsWith("video/")) {
        selectedFile = file;
        videoPreview.src = URL.createObjectURL(file);
        videoWrapper.classList.remove("hidden");
        uploadBtn.disabled = false;
        message.textContent = "";
        results.innerHTML = "";
      } else {
        message.textContent = "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–∏–¥–µ–æ—Ñ–∞–π–ª";
        uploadBtn.disabled = true;
        videoWrapper.classList.add("hidden");
        videoPreview.src = "";
      }
    });

    uploadBtn.addEventListener("click", async () => {
      if (!selectedFile) return;

      const formData = new FormData();
      formData.append("file", selectedFile);

      message.textContent = "‚è≥ –í–∏–¥–µ–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è...";
      uploadBtn.disabled = true;

      try {
        const response = await fetch("http://localhost:8000/process-video/", {
          method: "POST",
          body: formData
        });

        const data = await response.json();

        if (response.ok) {
          message.textContent = "‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω!";
          results.innerHTML = data.results.map(r => `
            <div class="result">
              <p><strong>Scene:</strong> ${r.scene_id}</p>
              <p><strong>Title:</strong> ${r.title}</p>
              <p><strong>Coords:</strong> ${r.latitude}, ${r.longitude}</p>
              <p><strong>Distance:</strong> ${r.distance.toFixed(6)}</p>
            </div>
          `).join("");
        } else {
          message.textContent = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ: " + (data.error || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
        }
      } catch (err) {
        console.error(err);
        message.textContent = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞";
      }

      uploadBtn.disabled = false;
    });
  </script>
</body>
</html>
